{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { useState, useEffect } from 'react';\nimport localForage from 'localforage';\n\nconst isObjectLiked = value => value.constructor.name === 'Array' || value.constructor.name === 'Object';\n\nconst rehydrate = (value, defaultValue) => {\n  if (!value) return defaultValue; // if (value === 'false') str = false;\n  // if (value === 'true') str = true;\n  // if (!isObjectLiked(value)) {\n  //   return value;\n  // }\n\n  try {\n    const parse = JSON.parse(value);\n    return parse;\n  } catch (err) {\n    return defaultValue;\n  }\n};\n\nconst hydrate = value => {\n  if (!isObjectLiked(value)) {\n    return value;\n  }\n\n  return JSON.stringify(value);\n};\n\nconst createMigration = (opts, data) => {\n  return new Promise((resolve, reject) => {\n    const key = `${opts.key}-version`;\n    localForage.getItem(key, (err, version) => {\n      if (version !== opts.version) {\n        data = opts.migrate(data);\n        localForage.setItem(opts.key, rehydrate(data), err => {\n          if (err) return reject(err);\n          localForage.setItem(key, opts.version, err => {\n            if (err) return reject(err);\n            return resolve(data);\n          });\n        });\n      } else {\n        resolve(data);\n      }\n    });\n  });\n};\n\nconst config = {\n  key: '@session',\n  version: 1,\n  migrate: state => {\n    return _objectSpread({}, state);\n  }\n};\nexport const useStorage = (state, setState) => {\n  const {\n    0: rehydrated,\n    1: setRehydrated\n  } = useState(false);\n  const {\n    0: error,\n    1: setError\n  } = useState(null);\n  useEffect(() => {\n    async function init() {\n      await localForage.getItem(config.key, (err, value) => {\n        if (err) {\n          setRehydrated(true);\n          return setError(err);\n        } // Migrate persisted data\n\n\n        const restoredValue = rehydrate(value);\n\n        if (typeof config.migrate === 'function') {\n          createMigration(config, restoredValue).then(data => setState(data)).then(() => setRehydrated(true));\n        } else {\n          setState(restoredValue);\n          setRehydrated(true);\n        }\n      });\n    }\n\n    init();\n  }, []);\n  useEffect(() => {\n    // if (isNil(state) || isEmpty(state)) {\n    //   localForage.removeItem(config.key);\n    // }\n    localForage.setItem(config.key, hydrate(state));\n  }, [state]);\n  return {\n    rehydrated,\n    error\n  };\n};","map":{"version":3,"names":["useState","useEffect","localForage","isObjectLiked","value","constructor","name","rehydrate","defaultValue","parse","JSON","err","hydrate","stringify","createMigration","opts","data","Promise","resolve","reject","key","getItem","version","migrate","setItem","config","state","useStorage","setState","rehydrated","setRehydrated","error","setError","init","restoredValue","then"],"sources":["/media/shohedul/New Volume/shop/helper/use-storage.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport localForage from 'localforage';\nconst isObjectLiked = (value) =>\n  value.constructor.name === 'Array' || value.constructor.name === 'Object';\n\nconst rehydrate = (value: any, defaultValue?: any) => {\n  if (!value) return defaultValue;\n  // if (value === 'false') str = false;\n  // if (value === 'true') str = true;\n  // if (!isObjectLiked(value)) {\n  //   return value;\n  // }\n  try {\n    const parse = JSON.parse(value);\n    return parse;\n  } catch (err) {\n    return defaultValue;\n  }\n};\n\nconst hydrate = (value) => {\n  if (!isObjectLiked(value)) {\n    return value;\n  }\n  return JSON.stringify(value);\n};\nconst createMigration = (opts, data) => {\n  return new Promise((resolve, reject) => {\n    const key = `${opts.key}-version`;\n    localForage.getItem(key, (err, version) => {\n      if (version !== opts.version) {\n        data = opts.migrate(data);\n        localForage.setItem(opts.key, rehydrate(data), (err) => {\n          if (err) return reject(err);\n          localForage.setItem(key, opts.version, (err) => {\n            if (err) return reject(err);\n            return resolve(data);\n          });\n        });\n      } else {\n        resolve(data);\n      }\n    });\n  });\n};\n\nconst config = {\n  key: '@session',\n  version: 1,\n  migrate: (state) => {\n    return { ...state };\n  },\n};\n\nexport const useStorage = (state, setState) => {\n  const [rehydrated, setRehydrated] = useState(false);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    async function init() {\n      await localForage.getItem(config.key, (err, value) => {\n        if (err) {\n          setRehydrated(true);\n          return setError(err);\n        }\n        // Migrate persisted data\n        const restoredValue = rehydrate(value);\n        if (typeof config.migrate === 'function') {\n          createMigration(config, restoredValue)\n            .then((data) => setState(data))\n            .then(() => setRehydrated(true));\n        } else {\n          setState(restoredValue);\n          setRehydrated(true);\n        }\n      });\n    }\n    init();\n  }, []);\n\n  useEffect(() => {\n    // if (isNil(state) || isEmpty(state)) {\n    //   localForage.removeItem(config.key);\n    // }\n    localForage.setItem(config.key, hydrate(state));\n  }, [state]);\n\n  return {\n    rehydrated,\n    error,\n  };\n};\n"],"mappings":";;;;;;AAAA,SAASA,QAAT,EAAmBC,SAAnB,QAAoC,OAApC;AACA,OAAOC,WAAP,MAAwB,aAAxB;;AACA,MAAMC,aAAa,GAAIC,KAAD,IACpBA,KAAK,CAACC,WAAN,CAAkBC,IAAlB,KAA2B,OAA3B,IAAsCF,KAAK,CAACC,WAAN,CAAkBC,IAAlB,KAA2B,QADnE;;AAGA,MAAMC,SAAS,GAAG,CAACH,KAAD,EAAaI,YAAb,KAAoC;EACpD,IAAI,CAACJ,KAAL,EAAY,OAAOI,YAAP,CADwC,CAEpD;EACA;EACA;EACA;EACA;;EACA,IAAI;IACF,MAAMC,KAAK,GAAGC,IAAI,CAACD,KAAL,CAAWL,KAAX,CAAd;IACA,OAAOK,KAAP;EACD,CAHD,CAGE,OAAOE,GAAP,EAAY;IACZ,OAAOH,YAAP;EACD;AACF,CAbD;;AAeA,MAAMI,OAAO,GAAIR,KAAD,IAAW;EACzB,IAAI,CAACD,aAAa,CAACC,KAAD,CAAlB,EAA2B;IACzB,OAAOA,KAAP;EACD;;EACD,OAAOM,IAAI,CAACG,SAAL,CAAeT,KAAf,CAAP;AACD,CALD;;AAMA,MAAMU,eAAe,GAAG,CAACC,IAAD,EAAOC,IAAP,KAAgB;EACtC,OAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;IACtC,MAAMC,GAAG,GAAI,GAAEL,IAAI,CAACK,GAAI,UAAxB;IACAlB,WAAW,CAACmB,OAAZ,CAAoBD,GAApB,EAAyB,CAACT,GAAD,EAAMW,OAAN,KAAkB;MACzC,IAAIA,OAAO,KAAKP,IAAI,CAACO,OAArB,EAA8B;QAC5BN,IAAI,GAAGD,IAAI,CAACQ,OAAL,CAAaP,IAAb,CAAP;QACAd,WAAW,CAACsB,OAAZ,CAAoBT,IAAI,CAACK,GAAzB,EAA8Bb,SAAS,CAACS,IAAD,CAAvC,EAAgDL,GAAD,IAAS;UACtD,IAAIA,GAAJ,EAAS,OAAOQ,MAAM,CAACR,GAAD,CAAb;UACTT,WAAW,CAACsB,OAAZ,CAAoBJ,GAApB,EAAyBL,IAAI,CAACO,OAA9B,EAAwCX,GAAD,IAAS;YAC9C,IAAIA,GAAJ,EAAS,OAAOQ,MAAM,CAACR,GAAD,CAAb;YACT,OAAOO,OAAO,CAACF,IAAD,CAAd;UACD,CAHD;QAID,CAND;MAOD,CATD,MASO;QACLE,OAAO,CAACF,IAAD,CAAP;MACD;IACF,CAbD;EAcD,CAhBM,CAAP;AAiBD,CAlBD;;AAoBA,MAAMS,MAAM,GAAG;EACbL,GAAG,EAAE,UADQ;EAEbE,OAAO,EAAE,CAFI;EAGbC,OAAO,EAAGG,KAAD,IAAW;IAClB,yBAAYA,KAAZ;EACD;AALY,CAAf;AAQA,OAAO,MAAMC,UAAU,GAAG,CAACD,KAAD,EAAQE,QAAR,KAAqB;EAC7C,MAAM;IAAA,GAACC,UAAD;IAAA,GAAaC;EAAb,IAA8B9B,QAAQ,CAAC,KAAD,CAA5C;EACA,MAAM;IAAA,GAAC+B,KAAD;IAAA,GAAQC;EAAR,IAAoBhC,QAAQ,CAAC,IAAD,CAAlC;EAEAC,SAAS,CAAC,MAAM;IACd,eAAegC,IAAf,GAAsB;MACpB,MAAM/B,WAAW,CAACmB,OAAZ,CAAoBI,MAAM,CAACL,GAA3B,EAAgC,CAACT,GAAD,EAAMP,KAAN,KAAgB;QACpD,IAAIO,GAAJ,EAAS;UACPmB,aAAa,CAAC,IAAD,CAAb;UACA,OAAOE,QAAQ,CAACrB,GAAD,CAAf;QACD,CAJmD,CAKpD;;;QACA,MAAMuB,aAAa,GAAG3B,SAAS,CAACH,KAAD,CAA/B;;QACA,IAAI,OAAOqB,MAAM,CAACF,OAAd,KAA0B,UAA9B,EAA0C;UACxCT,eAAe,CAACW,MAAD,EAASS,aAAT,CAAf,CACGC,IADH,CACSnB,IAAD,IAAUY,QAAQ,CAACZ,IAAD,CAD1B,EAEGmB,IAFH,CAEQ,MAAML,aAAa,CAAC,IAAD,CAF3B;QAGD,CAJD,MAIO;UACLF,QAAQ,CAACM,aAAD,CAAR;UACAJ,aAAa,CAAC,IAAD,CAAb;QACD;MACF,CAfK,CAAN;IAgBD;;IACDG,IAAI;EACL,CApBQ,EAoBN,EApBM,CAAT;EAsBAhC,SAAS,CAAC,MAAM;IACd;IACA;IACA;IACAC,WAAW,CAACsB,OAAZ,CAAoBC,MAAM,CAACL,GAA3B,EAAgCR,OAAO,CAACc,KAAD,CAAvC;EACD,CALQ,EAKN,CAACA,KAAD,CALM,CAAT;EAOA,OAAO;IACLG,UADK;IAELE;EAFK,CAAP;AAID,CArCM"},"metadata":{},"sourceType":"module"}